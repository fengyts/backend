<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" th:href="@{/plugins/layui/css/layui.css}" charset="UTF-8"/>
    <link rel="stylesheet" th:href="@{/layuiAdmin.css}" charset="UTF-8">
    <style>
        body {
            padding-right: 10px;
        }

        /* 重写 layui-css的 toolbar 样式*/
        .layui-table-tool {
            min-height: 35px !important;
            /*max-height: 50px !important;*/
            /*line-height: 35px !important;*/
            padding: 0 10px !important;
        }
    </style>
</head>
<body>
<div>
    <script type="text/html" id="deploymentListToolBar">
        <div>
            <span style="height: 10px; font-size: 12px;">流程部署列表</span>
            <button type="button" class="layui-btn layui-btn-sm" id="refreshDeploymentList">刷新</button>
        </div>
    </script>
    <script type="text/html" id="definitionListToolBar">
        <div>
            <span style="height: 10px; font-size: 12px;">流程定义列表</span>
            <button type="button" class="layui-btn layui-btn-sm" id="refreshProcessDefinition">刷新</button>
        </div>
    </script>
</div>
<div>
    <table id="deploymentList" lay-filter="deploymentList"></table>
    <table id="definitionList" lay-filter="definitionList"></table>
</div>

<script th:src="@{/plugins/jquery/jquery-3.5.1.min.js}" charset="utf-8"></script>
<script th:src="@{/plugins/layui/layui.js}" charset="utf-8"></script>
<script th:inline="javascript" th:src="@{holiday.js}" charset="utf-8"></script>
<script th:inline="javascript">
    layui.use(['table', 'util'], function () {
        var table = layui.table, util = layui.util;

        var deploymentList = table.render({
            elem: '#deploymentList',
            url: "/process/getDeploymentListData",
            method: 'get',
            toolbar: '#deploymentListToolBar',
            defaultToolbar: [],
            // height: 'full-180',
            cols: [
                [
                    {field: 'id', title: 'id', minWidth: 410, align: 'center'},
                    {field: 'name', title: '名称', minWidth: 150, align: 'center'},
                    {
                        field: 'deploymentTime', title: '发布时间', minWidth: 300, align: 'center', templet: rowData => {
                            return util.toDateString(rowData.deploymentTime, 'yyyy-MM-dd HH:mm:ss');
                        }
                    },
                ]
            ],
            page: false,
            parseData: function (res) {
                // console.log(res);
                return {
                    "code": '',
                    // "msg": res.msg,
                    // "count": res.total,
                    "data": res.data
                };
            }
        });
        var definitionList = table.render({
            elem: '#definitionList',
            url: "/process/getProcessDefinitionListData",
            method: 'get',
            toolbar: '#definitionListToolBar',
            defaultToolbar: [],
            // height: 'full-180',
            cols: [
                [
                    {
                        title: '操作', minWidth: 200, align: 'center', fixed: 'left', templet: rowData => {
                            let _html = '<span class="layui-btn layui-btn-xs" lay-event="viewProcessDiagram">查看流程图</span>',
                                _deployment = '<span class="layui-btn layui-btn-xs" lay-event="approve">部署</span>',
                                _edit = '<span class="layui-btn layui-btn-xs" lay-event="reSubmit">编辑</span>';
                            return _html + _deployment + _edit;
                        }
                    },
                    {field: 'id', title: 'id', minWidth: 410, align: 'center'},
                    {field: 'name', title: '名称', minWidth: 150, align: 'center'},
                    {field: 'key', title: '流程Key', minWidth: 150, align: 'center'},
                    {field: 'version', title: '版本', minWidth: 30, align: 'center'},
                    {field: 'deploymentId', title: '部署ID', minWidth: 300, align: 'center'},
                    {field: 'description', title: '描述', minWidth: 150, align: 'center'},
                    {field: 'resourceName', title: '来源', minWidth: 550, align: 'center'}
                ]
            ],
            page: false,
            parseData: function (res) {
                // console.log(res);
                return {
                    "code": '',
                    // "msg": res.msg,
                    // "count": res.total,
                    "data": res.data
                };
            }
        });

        $(document).on('click', '#refreshDeploymentList', function () {
            deploymentList.reload();
        });
        $(document).on('click', '#refreshProcessDefinition', function () {
            definitionList.reload();
        });
    });
</script>
</body>
</html>